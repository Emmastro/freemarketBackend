import json
import requests

import pandas as pd

api_token = 'AIzaSyAyxqmIKa6KChE5_PDNHz-Pi5b51iS6sgQ'
api_url_base = 'https://www.googleapis.com/books/v1/'

#headers = {'Content-Type': 'application/json',
#           'Authorization': 'glass-timing-229520 {0}'.format(api_token)}

datas = pd.read_excel('../../Datas.xlsx')

def get_book_details(search):

    #api_url = '{base}volumes?q={search}?key={key}'.format(base=api_url_base, search=search, key=api_token)
    api_url = '{base}volumes?q={search}'.format(base=api_url_base, search=search)

    response = requests.get(api_url)#, headers=headers)
    if response.status_code == 200:
        content = json.loads(response.content.decode('utf-8'))
        
        #book_info = content.get('volumeInfo')
        #print(response.content)
        return json.loads(response.content.decode('utf-8'))
    else:
        print(response.status_code)
        return None
#title subtitle author publisher publishedDate description industryIdentifiers pageCount categories

for i in range(191,207):
	import time
	#time.sleep(1)
	datas['Number'].where(pd.notna(datas['Number']), 1, True)
	datas['Subtitle'].where(pd.notna(datas['Subtitle']), '', True)
	datas['Description'].where(pd.notna(datas['Description']), '', True)
	datas['Author'].where(pd.notna(datas['Author']), '', True)

	search = datas['Title'][i] + ' ' + datas['Subtitle'][i] + ' ' + datas['Author'][i]
	#a=['9780330516358','IND:39000005645531','0811200418','9781472536365','1429954027','UOM:39015082152359','0545674778','078670795X','1840224118','9780393347401','034081201X','9789783603578','0636035034','063607093X','1868915166','0330368427','9781476665955','9781137305077','9781616726720','1435255003','9781317687665','9780812986075','9781448112838','1444121413','0435905384','','2843235200','STANFORD:36105003947764','9781551998534','9780571268245','9780062417367','9780763649456','9780731815807','071900859X','067406626X','9780192833204','OCLC:438410826','9780755351794','9781407052564','0192810502','9780241282083','0307514765','9780345803054','0393323404','9781473660922','052144652X','9781847650443','9781409151975','0811201406','9780141956305','STANFORD:36105123325578','OCLC:43967824','0872206785','0340200308','9781465585530','0692452745','9780141978642','9780230225312','9780007496952','8185944644','1614752923','1400083176','9780520969155','9781473531734','9781439115237','9781504047081','9781478002239','9783736800878','9781386873266','0520259912','','9780241199336','9780241199336','9780143528579','IND:39000004488073','0824822404','9782364561823','9781603744539','UOM:39015002283201','9781623710163','9783849635091','1617031100','LCCN:2003267318','9781405513593','9781408845974','0805071954','PSU:000011306146','9781480422490','9781135447564','OCLC:951073944','1882577574','9781483358352','UOM:39015005599280','9781453263389','0393095096','0878404856','9781408832677','9780141907185','1876451858','9776096239','9781134468478','9780007279289','9780742652859','0226173011','BNC:1000084285','9780486115061','9781407043746','8126900415','0521781442','9781408810279','0310936535','9780199707447','UOM:39015034932551','STANFORD:36105063780261','9781681952062','OCLC:69205234','9781448192571','9781317694458','9780689873973','817022411X','UOM:39015008146527','9780141910048','UOM:39015082524698','9780061743696','0521318068','0796249334','0798913959','9789991642116','NYPL:33433075751929','HARVARD:32044020999769','UOM:39015063515798','0691084351','9782806218025','9781442249042','0813927374','9781624663611','0115526080','9780486112091','OCLC:271676516','9780735253742','9781135593254','9780718086619','9780060765361','1444913565','9780307807991','STANFORD:36105114997385','9780571246144','OXFORD:590040740','UOM:39015066016026','0520046404','9781471402067','9780007255832','9780230374218','9639776149','1844670457','9781459616356','UCAL:$B681773','9780141965154','9780141984025','1603037608','1400829828','PKEY:SMP2300000062410','9781563054419','1627070672','9781458710697','9780718197810','9781409106210','1570612900','9781480437319','9781476767598','9781459246973','9780857976390','8087888367','9781429919555','9780141912868','9781848315860','9785041239824','9780141965154','0141026235','UCBK:B000875634','060619438X','0636141691','9780141912981','9781449409050','0717179885','9781770486492','9781781880005','0940450186','0452267110','0798149086','9780486473307','9781452712284','UOM:39015012258177','STANFORD:36105002563430','9781119285984','0642107408','0061972320','9781407033310','9781445662794','0847691675','HARVARD:32044055333041','UOM:39015082525042','0006729193','1442085665','0803263767','9781407052564','1444124307','1853264016','UOM:39015064982773','2881243002','0983822956','OXFORD:300006006','0080474985','0713614250','0415945011','1482018950','1883249597','0435511165','9781439144763','0801482798','UCAL:B3467649','STANFORD:36105038859877','0809314894','0764335103','079239965X','9781472800268','9780748110896','9781136173813','1770307672','9781616411565','9781780226965','9400715064','9781509844227','9780547524795','9781628726749','9781480444898','UCAL:$B787171','9781775560159','9780307773449','9781250091758','0571108644','9780571262335','IND:39000002373269','1429928611','9780141904191','0156260360','0151255989','9781448130269','9781439132029','9781416591320','9780465065684','9781442939356','OXFORD:600049531','9780316187107','9781602391338','1442039647','9780544340688','014302857X','UCD:31175035229684','9781473350199','9781409002109','UCSC:32106001971461','0531113329','0385467788','9780356507255','9781770722705','9781407059136','9781407059167','9780191501135','9781407073125','OCLC:948682135','9781438134383','9789401208390','1101209178','UOM:39015013292506','9780544176560','9781317203520','UOM:39015004820729','9780385742351','1844860140','0393983730','9780393979206','9781442642690','0192854372','UVA:X000238366','1101127619','NYPL:33433081852711','9781480409781','9780691143354','1544886926','UCAL:B3929684','9781504052542','9781407059198','9781409106241','9780199552092','0140257276','9781407059457','UCSC:32106011232334','1770092498','1581126468','9780143027188','9780857960115','9781501162800','158342122X','BL:A0017989433','9781446436035','9780525431633','9781543477726','186842460X','9781443421188','9789887739586','UOM:39015048900818','0948400927','9781848947542','9781101567753','024135708X','9780830843091','9788075830210','0517585154','0316107093','0192829254','0520074203','UVA:X000098407','9780857976420','9781409087519','192016216X','BNC:1001933411','9781497627260','9781497627260','UOM:39076006070697','BSB:BSB10469315','9781101664094','0807614386','9781473553590','9780330504355','9781466829060','9780061758126','9783736804807','UOM:39015046911965','0521076080','HARVARD:HN1WTP','0300078439','9781416939214','9781770098183']
	content = get_book_details(a[i])
	if content==None:
		content = get_book_details(datas['Title'][i])
	
	if content==None:
		content = get_book_details(datas['Title'][i] + ' ' + datas['Subtitle'][i])

	if content==None:
		content = get_book_details(search)


	if content!=None:

		items = content.get('items')
		#print(content)
		if items!=None:
			content = items[0].get('volumeInfo')
			print(i, '	',
				content.get('title'), '	',
			content.get('subtitle'), '	',
			content.get('authors'), '	',
			content.get('publisher'), '	',
			content.get('publishedDate'), '	',
			content.get('description'), '	',
			content.get('industryIdentifiers'), '	',
			content.get('pageCount'), '	',
			content.get('categories'), '	',
			content.get('imageLinks'), '	',
			content.get('maturityRating'), '	')
		else:
			print('no item', content, i)
	else:
		print('Unknown --> ', search, i)